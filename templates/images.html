<!DOCTYPE html>
<html>
<head>
<title>Infinitesoft-tr | Resimlerim</title>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4E0S2QW6KC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-4E0S2QW6KC');
</script>
<style>
body {
  font-family: system-ui;
  background:#0f172a;
  color:white;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, 200px);
  gap: 16px;
}

.card {
  width: 200px;
  height: 200px;
  border-radius: 18px;
  overflow: hidden;
  position: relative;
  cursor: pointer;
  background: #1e293b;
  transition: .25s ease;
}

.card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 40px rgba(0,0,0,.6);
}

.card::after {
  content: "‚¨á ƒ∞ndir";
  position: absolute;
  inset: 0;
  background: linear-gradient(
    to top,
    rgba(0,0,0,0.7),
    rgba(0,0,0,0.1)
  );
  display:flex;
  align-items:flex-end;
  justify-content:center;
  padding-bottom: 14px;
  font-weight:600;
  font-size:15px;
  opacity: 0;
  transition: .25s;
}

.card:hover::after {
  opacity: 1;
}

/* shimmer */
.shimmer {
  background: linear-gradient(
    90deg,
    #1e293b 25%,
    #334155 37%,
    #1e293b 63%
  );
  background-size: 400% 100%;
  animation: shimmer 1.4s infinite;
}

@keyframes shimmer {
  0% { background-position: 100% 0; }
  100% { background-position: -100% 0; }
}

.hidden { display: none; }

/* delete */
.delete {
  position:absolute;
  top:8px;
  right:8px;
  background:#ef4444;
  border:none;
  border-radius:50%;
  width:28px;
  height:28px;
  color:white;
  cursor:pointer;
  display:none;
  z-index:10;
}

.admin .delete {
  display:block;
}
</style>
</head>
<body>

<h1>üìÅ Resimlerim</h1>

<!-- loading -->
<div id="shimmer" class="grid">
  <div class="card shimmer"></div>
  <div class="card shimmer"></div>
  <div class="card shimmer"></div>
  <div class="card shimmer"></div>
  <div class="card shimmer"></div>
  <div class="card shimmer"></div>
</div>

<!-- real gallery -->
<div id="gallery" class="grid hidden"></div>

<script>
const HF_URL = "https://wf5528-infinitesoft-tr.hf.space";

// Flask template‚Äôden admin token ve yetkiyi alƒ±yoruz
const IS_ADMIN = '{{ "true" if session.get("can_delete") else "false" }};'
const ADMIN_TOKEN = "{{ session.get('admin_token', '') }}";

if (IS_ADMIN) {
  document.body.classList.add("admin");
}

fetch(HF_URL + "/list")
  .then(r => r.json())
  .then(data => {
    const gallery = document.getElementById("gallery");

    data.images.forEach(name => {
      const a = document.createElement("a");
      a.href = HF_URL + "/download/" + name;
      a.className = "card";

      const img = document.createElement("img");
      img.src = HF_URL + "/img/" + name;

      const del = document.createElement("button");
      del.className = "delete";
      del.innerText = "üóë";

      del.onclick = e => {
        e.preventDefault();
        e.stopPropagation();
        if (!confirm("Silinsin mi?")) return;

        fetch("/api/delete/" + name, {
          method: "GET", // veya POST, Flask tarafƒ±na g√∂re
          headers: {
            "X-SECRET": ADMIN_TOKEN
          }
        })
        .then(r => {
          if (r.status === 403) throw new Error("Yetki yok");
          return r.json();
        })
        .then(d => {
          if (d.ok) a.remove();
        })
        .catch(err => alert(err.message));
      };

      a.appendChild(img);
      a.appendChild(del);
      gallery.appendChild(a);
    });

    document.getElementById("shimmer").classList.add("hidden");
    gallery.classList.remove("hidden");
  });
</script>

</body>
</html>
